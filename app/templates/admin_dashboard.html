{% extends "base.html" %}

{% block title %}Admin - {{ super() }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="mb-4">Painel Administrativo</h1>

    <!-- Stats -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Total de ATMs</h5>
                    <p class="card-text fs-2">{{ atms_count }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Total de Usuários</h5>
                    <p class="card-text fs-2">{{ users_count }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Add ATM Form -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    Inserir Novo ATM
                </div>
                <div class="card-body">
                    <form action="{{ url_for('admin.add_atm') }}" method="POST">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="bank_name" name="bank_name" placeholder="Nome do Banco" required>
                            <label for="bank_name">Nome do Banco</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="address" name="address" placeholder="Endereço">
                            <label for="address">Endereço</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" step="any" class="form-control" id="latitude" name="latitude" placeholder="Latitude" required>
                            <label for="latitude">Latitude</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number" step="any" class="form-control" id="longitude" name="longitude" placeholder="Longitude" required>
                            <label for="longitude">Longitude</label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Gravar ATM</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ATM List -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    Lista de ATMs Geridos
                </div>
                <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Banco</th>
                                <th>Endereço</th>
                                <th>Latitude</th>
                                <th>Longitude</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for atm in atms %}
                            <tr>
                                <td>{{ atm.bank_name }}</td>
                                <td>{{ atm.address or 'N/A' }}</td>
                                <td>{{ atm.latitude }}</td>
                                <td>{{ atm.longitude }}</td>
                                <td>
                                    <a href="{{ url_for('admin.delete_atm', atm_id=atm.id) }}" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja apagar este ATM?');">Apagar</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    Lista de Usuários
                </div>
                <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome de Usuário</th>
                                <th>Email</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                            <tr>
                                <td>{{ user.id }}</td>
                                <td>{{ user.username }}</td>
                                <td>{{ user.email }}</td>
                                <td>
                                    <a href="{{ url_for('admin.delete_user', user_id=user.id) }}" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja apagar este usuário?');">Apagar</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}